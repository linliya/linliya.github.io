<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="林莉的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="林莉的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="林莉的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>林莉的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">林莉的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/12/byte & blob/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/12/byte & blob/" itemprop="url">bytes & blob</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-12T14:57:10+08:00">
                2018-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="blob是什么？"><a href="#blob是什么？" class="headerlink" title="blob是什么？"></a>blob是什么？</h3><p>blob, 即binary large object，二进制大对象，MDN上的定义是:</p>
<blockquote>
<p>Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是JavaScript原生格式的数据。File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件</p>
</blockquote>
<p>Blob 对象表示一个二进制文件的数据内容,可以看做是存放二进制数据的容器，一直以来，JS都没有比较好的可以直接处理二进制的方法。而Blob的出现，使我们可以通过JS直接操作二进制数据</p>
<blockquote>
<p>拓展: MySql/Oracle数据库中，有一种Blob类型，专门存放二进制数据</p>
</blockquote>
<h3 id="构建blob对象的方式"><a href="#构建blob对象的方式" class="headerlink" title="构建blob对象的方式"></a>构建blob对象的方式</h3><h4 id="Blob构造函数"><a href="#Blob构造函数" class="headerlink" title="Blob构造函数"></a>Blob构造函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Blob(array [, options])</span><br></pre></td></tr></table></figure>
<p>通过Blob构造函数可以创建blob对象，Blob构造函数接受两个参数。第一个参数是数组，成员是字符串或二进制对象，表示新生成的Blob实例对象的内容；第二个参数是可选的，是一个配置对象，目前只有一个属性type，它的值是一个字符串，表示数据的 MIME 类型，默认是空字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123; hello: &apos;world&apos; &#125;;</span><br><span class="line">var blob = new Blob([ JSON.stringify(obj) ], &#123;type : &apos;application/json&apos;&#125;);</span><br></pre></td></tr></table></figure>
<p>Blob具有两个实例属性size和type，分别返回数据的大小和类型。</p>
<blockquote>
<p>数据类型参见<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MIME类型</a></p>
</blockquote>
<ul>
<li>slice方法<br>可以实现大文件的<a href="https://scarletsky.github.io/2015/01/27/javascript-upload-slice-file-using-blob/" target="_blank" rel="noopener">分片上传</a><blockquote>
<p>slice() 方法接受三个参数，起始偏移量，结束偏移量，还有可选的 mime 类型。如果 mime 类型，没有设置，那么新的 Blob 对象的 mime 类型和父级一样</p>
</blockquote>
</li>
</ul>
<h3 id="File对象"><a href="#File对象" class="headerlink" title="File对象"></a>File对象</h3><p>文件(File) 接口提供有关文件的信息，并允许网页中的 JavaScript 访问其内容</p>
<p>File 对象是特殊类型的 Blob，且可以用在任意的 Blob 类型的 context 中</p>
<p>all files are blobs(所有的flies对象都是blobs对象)</p>
<p>not all blobs are files(不是所有的blobs对象都是file对象)</p>
<h4 id="1-怎么拿到一个file对象？"><a href="#1-怎么拿到一个file对象？" class="headerlink" title="1. 怎么拿到一个file对象？"></a>1. 怎么拿到一个file对象？</h4><ul>
<li><p>input 输入框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; onChange=&quot;display(event)&quot;&gt;</span><br><span class="line">  &lt;img id=&quot;img&quot;/&gt;</span><br><span class="line">  function display(e) &#123;</span><br><span class="line">    let img = document.getElementById(&apos;img&apos;)</span><br><span class="line">    img.src = URL.createObjectURL(e.target.files[0])</span><br><span class="line">    img.onload = function () &#123;</span><br><span class="line">      URL.revokeObjectURL(this.src)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>drag and drop 拖放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">element.ondrop = (e) =&gt; &#123;</span><br><span class="line">  let file = e.dataTransfer.files[0]</span><br><span class="line">  console.log(file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-file对象的属性"><a href="#2-file对象的属性" class="headerlink" title="2. file对象的属性"></a>2. file对象的属性</h4><ul>
<li><code>file.name</code> 文件名</li>
<li><code>file.size</code> 文件大小</li>
<li><code>file.type</code> 文件类型</li>
<li><code>file.lastModifiedDate</code> 文件最后修改时间</li>
</ul>
<h4 id="3-拿到file对象后如何处理"><a href="#3-拿到file对象后如何处理" class="headerlink" title="3. 拿到file对象后如何处理?"></a>3. 拿到file对象后如何处理?</h4><ul>
<li>FileReader.readAsArrayBuffer(Blob | File)<blockquote>
<p>开始读取指定的 Blob中的内容, 一旦完成, result 属性中保存的将是被读取文件的 ArrayBuffer 数据对象</p>
</blockquote>
</li>
<li>FileReader.readAsDataURL(Blob | File)<blockquote>
<p>开始读取指定的Blob中的内容。一旦完成，result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容。</p>
</blockquote>
</li>
<li>FileReader.readAsText(Blob | File)<blockquote>
<p>开始读取指定的Blob中的内容。一旦完成，result属性中将包含一个字符串以表示所读取的文件内容。</p>
</blockquote>
</li>
<li>FileReader.abort()<blockquote>
<p>中止读取操作。在返回时，readyState属性为DONE</p>
</blockquote>
</li>
</ul>
<p>例子: 用户上传文件后预览</p>
<h3 id="ArrayBuffer-对象-amp-TypedArray视图-amp-Dataview视图"><a href="#ArrayBuffer-对象-amp-TypedArray视图-amp-Dataview视图" class="headerlink" title="ArrayBuffer 对象 &amp; TypedArray视图 &amp; Dataview视图"></a>ArrayBuffer 对象 &amp; TypedArray视图 &amp; Dataview视图</h3><p>简单来说，ArrayBuffer是装着二进制数据的对象， <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a>对象代表原始的二进制数据，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noopener">TypedArray</a> 视图用来读写简单类型的二进制数据，<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noopener">DataView</a>视图用来读写复杂类型的二进制数据。<br>ArrayBuffer 不能直接操作，而是要通过TypedArray对象或 DataView 对象来操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个8字节的ArrayBuffer</span><br><span class="line">var b = new ArrayBuffer(8);  </span><br><span class="line">  </span><br><span class="line">// 创建一个指向b的视图v1，采用Int32类型，开始于默认的字节索引0，直到缓冲区的末尾  </span><br><span class="line">var v1 = new Int32Array(b);  </span><br><span class="line">  </span><br><span class="line">// 创建一个指向b的视图v2，采用Uint8类型，开始于字节索引2，直到缓冲区的末尾  </span><br><span class="line">var v2 = new Uint8Array(b, 2);  </span><br><span class="line">  </span><br><span class="line">// 创建一个指向b的视图v3，采用Int16类型，开始于字节索引2，长度为2  </span><br><span class="line">var v3 = new Int16Array(b, 2, 2);</span><br></pre></td></tr></table></figure>
<p>上面代码里变量的数据结构如下表所示：<br><img src="https://user-gold-cdn.xitu.io/2018/9/12/165cc5d7d759e61d?w=846&amp;h=470&amp;f=png&amp;s=33252" alt=""></p>
<h3 id="URL对象"><a href="#URL对象" class="headerlink" title="URL对象"></a>URL对象</h3><p>调用 URL 对象的 createObjectURL 方法，传入一个 File 对象或者 Blob 对象，能生成一个链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var blob = new Blob([&apos;Hello World!&apos;])</span><br><span class="line">var a = document.createElement(&apos;a&apos;)</span><br><span class="line">a.href = window.URL.createObjectURL(blob)</span><br><span class="line">a.download = &apos;a.txt&apos;</span><br><span class="line">a.textContent = &apos;Download&apos;</span><br><span class="line"></span><br><span class="line">document.body.appendChild(a)</span><br></pre></td></tr></table></figure></p>
<p>页面上生成了一个超链接，点击它就能下载一个名为 a.txt 的文件，里面的内容是 Hello World!</p>
<h3 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h3><p>在nodeJs中，我们还可以通过Buffer类进行buffer =&gt; base64的转化,base64是将二进制编码为文本的一种编码规则，将base64的值直接赋给img.src可以实现图片的展示</p>
<p>在JavaScript中，有2个函数分别用来处理解码和编码base64 字符串：</p>
<ul>
<li>atob() 解码通过base-64编码的字符串数据</li>
<li>btoa() 从二进制数据“字符串”创建一个base-64编码的ASCII字符串</li>
</ul>
<p>nodejs中,我们可以实现filesystem =&gt; buffer =&gt; base64的转化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function readDataAsBase64 (filepath) &#123;</span><br><span class="line">  let buffer = fs.readFileSync(filepath)</span><br><span class="line">  let base64 = Buffer.from(buffer).toString(&apos;base64&apos;)</span><br><span class="line">  return `data:image/$&#123;ext&#125;;base64,$&#123;base64&#125;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h3><p>IndexedDB 就是浏览器提供的本地数据库，它可以被网页脚本创建和操作。IndexedDB 允许储存大量数据，提供查找接口，还能建立索引。</p>
<h3 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h3><h4 id="1-filesystem-gt-blob-gt-file"><a href="#1-filesystem-gt-blob-gt-file" class="headerlink" title="1. filesystem =&gt; blob =&gt; file"></a>1. filesystem =&gt; blob =&gt; file</h4><p><code>blob</code>对象转<code>file</code>对象，<code>blob</code>可以看成存放二进制文件的容器，因此可以将系统中的文件读取后转化成<code>blob</code>,<code>blob</code>又可以转化成<code>file</code>对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># nodejs中</span><br><span class="line">function blobToFile(filePath) &#123;</span><br><span class="line">    fs.openSync(filePath, &apos;w&apos;)</span><br><span class="line">    </span><br><span class="line">    let buffer = fs.readFileSync(filePath)</span><br><span class="line">    </span><br><span class="line">    let blob = new Blob([buffer], &#123;type: &apos;application/octet-stream&apos;&#125;)</span><br><span class="line">    let file = new File([blob], filename)</span><br><span class="line"></span><br><span class="line">    return file  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-filesystem-gt-blob-gt-dom-URL"><a href="#2-filesystem-gt-blob-gt-dom-URL" class="headerlink" title="2. filesystem =&gt; blob =&gt; dom(URL)"></a>2. filesystem =&gt; blob =&gt; dom(URL)</h4><p>选择本地图片后预览<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; onChange=&quot;display(event)&quot;&gt;</span><br><span class="line">&lt;img id=&quot;img&quot;/&gt;</span><br><span class="line"></span><br><span class="line">function display(e) &#123;</span><br><span class="line">  let img = document.getElementById(&apos;img&apos;)</span><br><span class="line">  img.src = URL.createObjectURL(e.target.files[0])</span><br><span class="line">  img.onload = function () &#123;</span><br><span class="line">    URL.revokeObjectURL(this.src)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-filesystem-gt-blob-gt-web"><a href="#3-filesystem-gt-blob-gt-web" class="headerlink" title="3. filesystem =&gt; blob =&gt; web"></a>3. filesystem =&gt; blob =&gt; web</h4><p>上传blob &amp; 上传文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function uploadBlob (url, blob, callback) &#123;</span><br><span class="line">  let request = new XMLHttpRequest()</span><br><span class="line">  request.open(&apos;POST&apos;, url)</span><br><span class="line">  request.send(blob)</span><br><span class="line">  request.upload.onprogress = callback</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function uploadFiles (url, files) &#123;</span><br><span class="line">  let request = new XMLHttpRequest()</span><br><span class="line">  request.open(&apos;POST&apos;, url)</span><br><span class="line">  let formData = new FormData()</span><br><span class="line">  for (let i = 0; i &lt; files.length; i++) &#123;</span><br><span class="line">    formData.append(files[i].name, files[i]</span><br><span class="line">  &#125;</span><br><span class="line">  request.send(formData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-web-gt-blob-gt-dom"><a href="#4-web-gt-blob-gt-dom" class="headerlink" title="4. web =&gt; blob =&gt; dom"></a>4. web =&gt; blob =&gt; dom</h4><p>从服务器下载一张图片并显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest()</span><br><span class="line">xhr.open(&apos;get&apos;, &apos;1.jpg&apos;, true)</span><br><span class="line">xhr.responseType = &apos;blob&apos;</span><br><span class="line">xhr.onload = function() &#123;</span><br><span class="line">  if (this.status == 200) &#123;</span><br><span class="line">    var blob = this.response</span><br><span class="line">    var img = document.createElement(&apos;img&apos;)</span><br><span class="line">    img.onload = function(e) &#123;</span><br><span class="line">      window.URL.revokeObjectURL(img.src)</span><br><span class="line">    &#125;</span><br><span class="line">    img.src = window.URL.createObjectURL(blob)</span><br><span class="line">    eleAppend.appendChild(img)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.send()</span><br></pre></td></tr></table></figure></p>
<h4 id="5-blob-lt-gt-indexedDB"><a href="#5-blob-lt-gt-indexedDB" class="headerlink" title="5. blob &lt;=&gt; indexedDB"></a>5. blob &lt;=&gt; indexedDB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># blob =&gt; indexedDB</span><br><span class="line">store.put(blob)</span><br><span class="line"># get blob from indexedDB</span><br><span class="line">let request = blob = store.get(key)</span><br><span class="line">request.onsuccess = function () &#123;</span><br><span class="line">  let blob = request.result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-blob-lt-gt-worker"><a href="#6-blob-lt-gt-worker" class="headerlink" title="6. blob &lt;=&gt; worker"></a>6. blob &lt;=&gt; worker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">worker.postMessage(blob)</span><br><span class="line">worker.onmessage = function (e) &#123;</span><br><span class="line">  let blob = e.data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结: 本文简单地介绍了跟blob相关的一些内容，只是抛砖引玉，大家有错误可以指出</p>
<p>参考链接: </p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Blob</a></li>
<li><a href="https://www.zhangxinxu.com/wordpress/2013/10/understand-domstring-document-formdata-blob-file-arraybuffer/" target="_blank" rel="noopener">https://www.zhangxinxu.com/wordpress/2013/10/understand-domstring-document-formdata-blob-file-arraybuffer/</a></li>
<li><a href="http://es6.ruanyifeng.com/#docs/arraybuffer" target="_blank" rel="noopener">http://es6.ruanyifeng.com/#docs/arraybuffer</a></li>
<li><a href="https://scarletsky.github.io/2015/01/27/javascript-upload-slice-file-using-blob/" target="_blank" rel="noopener">https://scarletsky.github.io/2015/01/27/javascript-upload-slice-file-using-blob/</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/27/js中的神奇代码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/27/js中的神奇代码/" itemprop="url">js中的神奇代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-27T14:47:37+08:00">
                2018-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>js中，有一些解决方案很值得斟酌，有时候简单的几行代码，能解决很复杂的问题，我在这里做一下记录，就当作是一个工具包吧</p>
<h4 id="请用代码实现test-2-3-4-5-120这个函数"><a href="#请用代码实现test-2-3-4-5-120这个函数" class="headerlink" title="请用代码实现test(2)(3)(4)(5) = 120这个函数"></a>请用代码实现test(2)(3)(4)(5) = 120这个函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function test(x)&#123;</span><br><span class="line">  var sum = x;</span><br><span class="line">  var mod = function(y) &#123;</span><br><span class="line">    sum = sum * y;</span><br><span class="line">    return mod;</span><br><span class="line">  &#125;;</span><br><span class="line">  mod.toString =function()&#123;</span><br><span class="line">    return sum;</span><br><span class="line">  &#125;;</span><br><span class="line">  return mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="格式化日期，包含-年-月-日"><a href="#格式化日期，包含-年-月-日" class="headerlink" title="格式化日期，包含 年-月-日"></a>格式化日期，包含 <code>年-月-日</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> # @param &#123;Date|String&#125; date 时间戳</span><br><span class="line"> # @returns &#123;String&#125; 按照`-`分割开的日期显示字符串</span><br><span class="line"></span><br><span class="line">const formatDate = date =&gt; &#123;</span><br><span class="line">  let dateFormat = new Date(date)</span><br><span class="line">  if (!dateFormat) return &apos;&apos;</span><br><span class="line">  const year = dateFormat.getFullYear()</span><br><span class="line">  const month = dateFormat.getMonth() + 1</span><br><span class="line">  const day = dateFormat.getDate()</span><br><span class="line"></span><br><span class="line">  return [year, month, day].map(formatNumber).join(&apos;-&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const formatNumber = n =&gt; &#123;</span><br><span class="line">  n = n.toString()</span><br><span class="line">  return n[1] ? n : &apos;0&apos; + n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="格式化时间，包含-年-月-日-时-分-秒"><a href="#格式化时间，包含-年-月-日-时-分-秒" class="headerlink" title="格式化时间，包含 年-月-日 时-分-秒"></a>格式化时间，包含 <code>年-月-日 时-分-秒</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> # @param &#123;Date|String&#125; date 时间戳</span><br><span class="line"> # @returns &#123;String&#125; 按照`-`分割开的时间显示字符串</span><br><span class="line"> </span><br><span class="line">const formatTime = date =&gt; &#123;</span><br><span class="line">  if (!date) return &apos;&apos;</span><br><span class="line">  let dateFormat = new Date(date)</span><br><span class="line">  if (!dateFormat) return &apos;&apos;</span><br><span class="line">  const year = dateFormat.getFullYear()</span><br><span class="line">  const month = dateFormat.getMonth() + 1</span><br><span class="line">  const day = dateFormat.getDate()</span><br><span class="line">  const hour = dateFormat.getHours()</span><br><span class="line">  const minute = dateFormat.getMinutes()</span><br><span class="line">  const second = dateFormat.getSeconds()</span><br><span class="line"></span><br><span class="line">  return [year, month, day].map(formatNumber).join(&apos;-&apos;) + &apos; &apos; + [hour, minute, second].map(formatNumber).join(&apos;:&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="格式化文件大小显示"><a href="#格式化文件大小显示" class="headerlink" title="格式化文件大小显示"></a>格式化文件大小显示</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> # @param &#123;Number&#125; size 大小</span><br><span class="line"> # @returns &#123;String&#125; 格式化后的容量大小</span><br><span class="line"></span><br><span class="line">const formatSize = size =&gt; &#123;</span><br><span class="line">  if (typeof size !== &apos;number&apos; || size &lt; 0) &#123;</span><br><span class="line">    return &apos;0 B&apos;</span><br><span class="line">  &#125;</span><br><span class="line">  if (size &lt; 1024) return `$&#123;size&#125; B`</span><br><span class="line">  size = size % 1024 === 0 ? size / 1024 : (size / 1024).toFixed(2)</span><br><span class="line">  if (size &lt; 1024) return `$&#123;size&#125; KB`</span><br><span class="line">  size = size % 1024 === 0 ? size / 1024 : (size / 1024).toFixed(2)</span><br><span class="line">  if (size &lt; 1024) return `$&#123;size&#125; MB`</span><br><span class="line">  size = size % 1024 === 0 ? size / 1024 : (size / 1024).toFixed(2)</span><br><span class="line">  if (size &lt; 1024) return `$&#123;size&#125; GB`</span><br><span class="line">  size = size % 1024 === 0 ? size / 1024 : (size / 1024).toFixed(2)</span><br><span class="line">  if (size &lt; 1024) return `$&#123;size&#125; TB`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/10/项目难点笔记本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/10/项目难点笔记本/" itemprop="url">项目难点笔记本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-10T13:40:58+08:00">
                2018-08-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="h264解码"><a href="#h264解码" class="headerlink" title="h264解码"></a>h264解码</h3><p>在做h264解码的过程，一开始是想利用broadway.js这个项目，让后台通过websocket将h264数据一帧一帧地传给我们，我们来完成前端解码的工作，但是因为该项目文档并不是很清楚，所以我们解码一直没成功，也没有报错，所以我们转战其它类似的项目，h264bsd是一个基于broadway.js的一个项目，但它的文档相对比较清楚，也有例子，我们就再试了一下，这时试的是一整个h264的文件，而不是一帧帧的数据，而且，后台也提供了两个压缩率不同的h264文件，这次终于解码成功了，压缩率为baseline类型的成功了，压缩率为high的同样没有解码成功，于是我们终于找到问题的所在，压缩率这个问题导致解码器一直没有解码成功</p>
<p>这里的压缩率其实是指压缩过程i帧的比例,baseline的i帧比较多，high压缩的p帧比较多</p>
<p>H264压缩技术主要采用了以下几种方法对视频数据进行压缩。包括：</p>
<p>帧内预测压缩，解决的是空域数据冗余问题。<br>帧间预测压缩（运动估计与补偿），解决的是时域数据冗徐问题。<br>整数离散余弦变换（DCT），将空间上的相关性变为频域上无关的数据然后进行量化。<br>CABAC压缩。</p>
<p>经过压缩后的帧分为：I帧，P帧和B帧:<br>I帧：关键帧，采用帧内压缩技术。<br>P帧：向前参考帧，在压缩时，只参考前面已经处理的帧。采用帧音压缩技术。<br>B帧：双向参考帧，在压缩时，它即参考前而的帧，又参考它后面的帧。采用帧间压缩技术</p>
<p>还有一种常见的压缩，JPEG压缩，JPEG的有损压缩，损的是量化过程中的高频部分</p>
<h3 id="不同分辨率canvas的处理问题"><a href="#不同分辨率canvas的处理问题" class="headerlink" title="不同分辨率canvas的处理问题"></a>不同分辨率canvas的处理问题</h3><p>通过css设定宽高解决</p>
<h3 id="创建一个空文件并转成File格式上传到服务器"><a href="#创建一个空文件并转成File格式上传到服务器" class="headerlink" title="创建一个空文件并转成File格式上传到服务器"></a>创建一个空文件并转成File格式上传到服务器</h3><ul>
<li>通过fs.openSync创建一个空的文件</li>
<li>通过fs.readFile读取文件内容</li>
<li>将读取到的文件内容传给一个Blob对象</li>
<li>将Blob对象转成File格式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getUploadFile(filePath) &#123;</span><br><span class="line">    fs.openSync(filePath, &apos;w&apos;)</span><br><span class="line">    </span><br><span class="line">    let file = fs.readFileSync(filePath)</span><br><span class="line">    </span><br><span class="line">    let b = new Blob([file], &#123;type: &apos;application/octet-stream&apos;&#125;)</span><br><span class="line">    let emptyFile = new File([b], filename)</span><br><span class="line"></span><br><span class="line">    #可以上传的File对象</span><br><span class="line">    return emptyFile  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/05/element树形控件踩坑日记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/05/element树形控件踩坑日记/" itemprop="url">element树形控件踩坑日记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-05T17:23:12+08:00">
                2018-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在做一个管理系统，页面左侧需要一个目录树，便于文件的操作，不想从头开始造轮子，于是就考虑采用iview或者element的tree，调研后发现iview的tree还是有点局限，没有拖拽移动功能，没有懒加载子目录的功能等等，而element则比较符合我们的需求，虽然坑也是有点多…</p>
<h3 id="lazy-amp-load"><a href="#lazy-amp-load" class="headerlink" title="lazy &amp; load"></a>lazy &amp; load</h3><p>在<code>&lt;el-tree&gt;</code>中加入lazy属性，可以让树变成懒加载的tree,即默认渲染左边的下拉小箭头，点击每个小箭头可以触发一次load操作，可以实现动态获取树下面节点的操作</p>
<blockquote>
<p>这里遇到了第一个问题：怎么获取每个节点对应的路径？</p>
</blockquote>
<p>我们需要根据每个节点所在的路径向后台发送请求，节点的路径就是我们请求的资源路径，当然拿到这个路径的方法就是字符串拼接，拿到当前节点的node对象，根据它是否存在parent，将它的parent推入我们的currentPath数组中，每次推进数组之后需要将当前节点设置为它的parent,当然这个思路还是费了一点时间才想到的-_-!!</p>
<ul>
<li>获取每个节点对应路径的方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前文件所在路径</span><br><span class="line">getCurrentPath (node) &#123;</span><br><span class="line">  if (node &amp;&amp; node.data &amp;&amp; node.data.name) &#123;</span><br><span class="line">    let nodeParent = node.parent</span><br><span class="line">    this.currentPath = [node.data.name]</span><br><span class="line">    while (nodeParent &amp;&amp; nodeParent.data &amp;&amp; nodeParent.data.name</span><br><span class="line">           &amp;&amp; typeof nodeParent.data === &apos;object&apos;) &#123;</span><br><span class="line">      this.currentPath.unshift(nodeParent.data.name)</span><br><span class="line">      nodeParent = nodeParent.parent</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="props"><a href="#props" class="headerlink" title="props"></a>props</h3><p>我们创建文件的时候，是不需要<code>lazy load</code>时生成的小箭头的，因为文件下面是不能创建文件的，因此，需要做一下配置，在创建文件的时候给el-tree传一下类型，跟它说我要创建的是文件，不要给我渲染一个小箭头了，那要怎么配置呢？其实这个问题element官方文档有具体的例子</p>
<blockquote>
<p>第二个问题：怎么选择性渲染<code>lazy load</code>生成的小箭头?<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">  :props=&quot;props1&quot;</span><br><span class="line">  :load=&quot;loadNode1&quot;</span><br><span class="line">  lazy&gt;</span><br><span class="line">&lt;/el-tree&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        props1: &#123;</span><br><span class="line">          label: &apos;name&apos;,</span><br><span class="line">          children: &apos;zones&apos;,</span><br><span class="line">          isLeaf: &apos;leaf&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      loadNode1(node, resolve) &#123;</span><br><span class="line">        if (node.level === 0) &#123;</span><br><span class="line">          return resolve([&#123; name: &apos;region&apos; &#125;]);</span><br><span class="line">        &#125;</span><br><span class="line">        if (node.level &gt; 1) return resolve([]);</span><br><span class="line"></span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          const data = [&#123;</span><br><span class="line">            name: &apos;leaf&apos;,</span><br><span class="line">            leaf: true</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            name: &apos;zone&apos;</span><br><span class="line">          &#125;];</span><br><span class="line"></span><br><span class="line">          resolve(data);</span><br><span class="line">        &#125;, 500);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="renderContent"><a href="#renderContent" class="headerlink" title="renderContent"></a>renderContent</h3><p>renderContent会监听data里面的属性值来决定是否渲染和渲染对应的视图，如果有对某个data的属性值判断的需要，需要对那个属性值进行初始化</p>
<p>例如:<br>根据node节点的data.type决定渲染的内容,一开始需要给data.type赋初始值，如果不赋值则监听不到变化(我就是因为一开始没有初始化type,直接设置data.type=’edit’,然后视图一直没更新……)</p>
<blockquote>
<p>第三个问题: 为什么data.type变化了，视图一直没更新?</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 重命名编辑框</span><br><span class="line">if (data.type === &apos;edit&apos;) &#123;</span><br><span class="line">  return h(&apos;input&apos;, &#123;</span><br><span class="line">    attrs: &#123;</span><br><span class="line">      id: &apos;treeInput&apos;,</span><br><span class="line">      value: this.currentNodeData.name</span><br><span class="line">    &#125;,</span><br><span class="line">    on: &#123;</span><br><span class="line">      blur: (e) =&gt; &#123;</span><br><span class="line">        this.updateCurrentNode(e.target.value || data.name)</span><br><span class="line">      &#125;,</span><br><span class="line">      keyup: (e) =&gt; &#123;</span><br><span class="line">        if (e.keyCode === 13 || e.keyCode === 27) &#123;</span><br><span class="line">          e.target.blur()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"># 新建编辑框</span><br><span class="line">if (data.type === &apos;input&apos;) &#123;</span><br><span class="line">  return h(&apos;input&apos;, &#123;</span><br><span class="line">    attrs: &#123;</span><br><span class="line">      id: &apos;treeInput&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    on: &#123;</span><br><span class="line">      blur: (e) =&gt; &#123;</span><br><span class="line">        this.createNewNode(e.target.value)</span><br><span class="line">      &#125;,</span><br><span class="line">      keyup: (e) =&gt; &#123;</span><br><span class="line">        if (e.keyCode === 13 || e.keyCode === 27) &#123;</span><br><span class="line">          e.target.blur()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里还有一个小问题:<code>on-blur</code>和<code>on-keyup</code>本来我写的都是<code>this.createNewNode(e.target.value)</code>,但是触发了两次<code>create</code>操作，原来是<code>keyup</code>的同时输入框也会失去焦点，所以就触发了<code>blur</code>，因此就用<code>e.target.blur()</code>代替了原本的写法，统一用<code>blur</code>来实现触发<code>create</code>的操作</p>
<h3 id="浏览器渲染问题"><a href="#浏览器渲染问题" class="headerlink" title="浏览器渲染问题"></a>浏览器渲染问题</h3><blockquote>
<p>第四个问题: 为什么需要setTimeout?</p>
</blockquote>
<p>我们对树的操作的过程经常需要使用到setTimeout(fn, 0)，例如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tryToCreateNode (type) &#123;</span><br><span class="line">  this.$refs.tree.append(&#123;</span><br><span class="line">    id: &apos;treeInput&apos;,</span><br><span class="line">    type: &apos;create&apos;</span><br><span class="line">  &#125;, this.currentNodeData.id)</span><br><span class="line">  this.currentNode.expanded = true</span><br><span class="line">  this.createNewWay = &apos;append&apos;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    this.$el.querySelector(&apos;#treeInput&apos;).focus()</span><br><span class="line">  &#125;, 0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是因为当我们执行了append操作时，触发了浏览器的重排和重绘，需要重新构建dom树，这个过程是比较耗费时间的，如果我们接下来直接执行<code>this.$el.querySelector(&#39;#treeInput&#39;).focus()</code>,这时候dom树是还没有treeInput这个元素的，setTimeout会将querySelector操作放进任务队列中去，等到主进程完成dom树的构建后再执行setTimeout里面的操作，这时候我们就可以拿到我们的treeInput了</p>
<p>暂时就遇到这几个问题，如果有后续会再补充…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/05/用vue写一个简易版面板分割组件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/05/用vue写一个简易版面板分割组件/" itemprop="url">用vue写一个简易版面板分割组件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-05T17:21:27+08:00">
                2018-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近需要用到一个面板分割组件，于是动手自己写了一个简易版的，有以下功能:</p>
<ul>
<li>trigger样式自定义</li>
<li>左面板宽度可以设置默认值</li>
<li>左面板宽度可以设置最大最小值</li>
</ul>
<p>一般使用够用的了，如果以后需要继续可以增加功能…</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ul>
<li>设置<code>cursor: col-resize</code>可以让鼠标变成↔️这个图标(这个很多人都不知道吧^_^)</li>
<li>通过监听<code>mousedown</code>,获取鼠标开始拖拽<code>trigger</code>的位置</li>
<li>通过监听<code>mousemove</code>实时获取鼠标的位置，设置左右两边的宽度</li>
<li>通过监听<code>mouseup</code>结束trigger的拖拽，左右两边宽度不再随着鼠标移动而变化</li>
</ul>
<h3 id="html部分"><a href="#html部分" class="headerlink" title="html部分"></a>html部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;div </span><br><span class="line">  class=&quot;split-pane&quot; </span><br><span class="line">  ref=&quot;wraper&quot;</span><br><span class="line">  @mouseup=&quot;handleMouseup&quot;</span><br><span class="line">  @mousemove=&quot;handleMouseMove&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;split-pane-container&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;split-pane-left-area&quot; :style=&quot;&#123;width: leftSize&#125;&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;left&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">      &lt;slot name=&quot;split-pane-trigger&quot;&gt;</span><br><span class="line">        &lt;div </span><br><span class="line">          ref=&quot;trigger&quot;</span><br><span class="line">          class=&quot;split-pane-trigger&quot;</span><br><span class="line">          :style=&quot;horizontalTriggerStyle&quot;</span><br><span class="line">          @mousedown=&quot;handleMousedown&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">      &lt;div class=&quot;split-pane-right-area&quot; :style=&quot;&#123;width: rightSize&#125;&quot;&gt;</span><br><span class="line">        &lt;slot name=&quot;right&quot;&gt;&lt;/slot&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>核心是slot元素，插槽功能可以让我们在使用的时候设置要左右分割的内容区域</p>
<h3 id="js部分"><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h3><ul>
<li>自定义trigger样式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">horizontalTriggerStyle () &#123;</span><br><span class="line">  return Object.assign(&#123;left: this.leftSize&#125;, this.triggerStyle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>通过<code>Object.assign</code>将组件内部设置的样式和通过<code>prop</code>传入的<code>triggelStyle</code>结合成一个<code>horizontalTriggerStyle</code>对象</p>
<ul>
<li>初始化左侧宽度<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">computed () &#123;</span><br><span class="line">    leftSize () &#123;</span><br><span class="line">      return this.triggerOffset + &apos;px&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mounted () &#123;</span><br><span class="line">  if (this.value) &#123;</span><br><span class="line">    this.$nextTick(() =&gt; &#123;</span><br><span class="line">      this.triggerOffset = this.transValue(this.value)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;   </span><br><span class="line">&#125;</span><br><span class="line"># 将值转为Number并转换成百分比</span><br><span class="line">transValue (val) &#123;</span><br><span class="line">  return typeof val === &apos;number&apos;</span><br><span class="line">    ? val</span><br><span class="line">    : Math.floor(parseInt(val))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件挂载完成后通过判断是否传入<code>value</code>参数，设置组件的<code>triggerOffset</code>值，而左侧的宽度则是通过<code>triggerOffset</code>值<code>computed</code>而来的，因此就可以达到设置默认值的目的</p>
<ul>
<li>处理鼠标在trigger上按下事件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">handleMousedown (e) &#123;</span><br><span class="line">  this.canMove = true</span><br><span class="line">  this.preTriggerOffset = this.triggerOffset</span><br><span class="line">  # 记录开始按下的位置</span><br><span class="line">  this.offset = &#123;</span><br><span class="line">    x: e.pageX,</span><br><span class="line">    y: e.pageY</span><br><span class="line">  &#125;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>将<code>canMove</code>属性设置为true,表示从该位置可以开始移动，同时通过<code>this.offset</code>记录当前鼠标所在坐标位置</p>
<ul>
<li>处理鼠标移动<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">handleMouseMove (e) &#123;</span><br><span class="line">  if (this.canMove) &#123;</span><br><span class="line">    let moveSize = this.transValue(e.clientX - this.offset.x)</span><br><span class="line">    let offset = this.preTriggerOffset + moveSize</span><br><span class="line"></span><br><span class="line">    if (offset &lt;= this.minTransed) &#123;</span><br><span class="line">      this.triggerOffset = Math.max(offset, this.minTransed)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.triggerOffset = Math.min(offset, this.maxTransed)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>根据<code>e.clientX - this.offset.x</code>得到鼠标移动的距离，将这个距离和开始移动的坐标相加得到trigger应该距离左边的距离，再与面板最小最大值比较，得到最终的<code>triggerOffset</code></p>
<ul>
<li>处理鼠标抬起<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleMouseup () &#123;</span><br><span class="line">  this.canMove = false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>将canMove设置为false，结束拖拽</p>
<h3 id="怎么使用"><a href="#怎么使用" class="headerlink" title="怎么使用?"></a>怎么使用?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;c-split-pane :value=&quot;260&quot; min=&quot;260&quot; max=&quot;600&quot;&gt;</span><br><span class="line">  &lt;div slot=&quot;left&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div slot=&quot;right&quot;&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/c-split-pane&gt;</span><br></pre></td></tr></table></figure>
<p>总结: 这就是简易面板分割组件的具体实现过程啦~本来第一版是通过百分比实现的，但是因为百分比的宽度会根据页面大小变化，比如当你把页面最大化后将左侧拖动到最大，但是缩小后它又不是在最大的位置上了，所以会有点奇怪，最后还是改成用<code>px</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/26/图片懒加载的三种方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/26/图片懒加载的三种方式/" itemprop="url">图片懒加载的三种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-26T17:39:48+08:00">
                2018-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul>
<li>在页面放置img标签</li>
<li>给img图片加上alt, width, height 和 data-src</li>
<li>通过js判断页面是否滚动到某张图片需要显示的位置，这时将src赋值为data-src</li>
</ul>
<h3 id="offsetTop方式"><a href="#offsetTop方式" class="headerlink" title="offsetTop方式"></a>offsetTop方式</h3><p>图片出现在视窗内的情况：<br>offsetTop &lt; clientHeight + scrollTop</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/23/162f0988f351ecca?imageslim" alt=""></p>
<h3 id="getBoundingClientRect方式"><a href="#getBoundingClientRect方式" class="headerlink" title="getBoundingClientRect方式"></a>getBoundingClientRect方式</h3><p>图片出现在视窗内的情况：<br>element.getBoundingClientRect().top &lt; clientHeightf</p>
<h3 id="h5的IntersectionObserver方式"><a href="#h5的IntersectionObserver方式" class="headerlink" title="h5的IntersectionObserver方式"></a>h5的IntersectionObserver方式</h3><ul>
<li>intersectionRatio：目标元素的可见比例，即 intersectionRect 占 boundingClientRect 的比例，完全可见时为 1 ，完全不可见时小于等于 0</li>
</ul>
<p>具体用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function getTag(tag) &#123;</span><br><span class="line">    return Array.from(document.getElementsByTagName(tag));</span><br><span class="line">&#125;</span><br><span class="line">var observer = new IntersectionObserver(</span><br><span class="line">    (changes) =&gt; &#123;</span><br><span class="line">        changes.forEach((change) =&gt; &#123;</span><br><span class="line">            if (change.intersectionRatio &gt; 0) &#123;</span><br><span class="line">                var img = change.target;</span><br><span class="line">                img.src = img.dataset.src;</span><br><span class="line">                observer.unobserve(img);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">getTag(&apos;img&apos;).forEach((item) =&gt; &#123;</span><br><span class="line">    observer.observe(item);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul>
<li><p>通过以下css可以提高性能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 之所以使用visibility而不是display是因为</span><br><span class="line"># visibility不会触发重绘(repaint)和重排(reflow)</span><br><span class="line">img &#123;</span><br><span class="line">  visibility: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img[src] &#123;</span><br><span class="line">  visibility: visible;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>因为scroll事件的触发频率很高，频繁操作dom结点会造成很大的性能问题，所以需要做节流和防抖设计，减少scroll事件的触发频率</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/小程序开发日记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/小程序开发日记/" itemprop="url">小程序开发日记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-22T17:16:55+08:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在学小程序开发，想做一个小demo练练手，边学边总结，希望能对以后想学的同学有点作用：</p>
<h4 id="request请求豆瓣图书接口报了403"><a href="#request请求豆瓣图书接口报了403" class="headerlink" title="request请求豆瓣图书接口报了403"></a>request请求豆瓣图书接口报了403</h4><p>查资料后才知道豆瓣图书的接口对小程序不开放了…用了同事反向代理豆瓣api的接口才搞定的</p>
<h4 id="request请求同事服务器的接口报了400"><a href="#request请求同事服务器的接口报了400" class="headerlink" title="request请求同事服务器的接口报了400"></a>request请求同事服务器的接口报了400</h4><p>通过wx.request请求资源时需要加上header头部<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header: &#123;</span><br><span class="line">  &quot;Content-Type&quot;: &quot;json&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header: &#123;</span><br><span class="line">  &quot;Content-Type&quot;: &quot;application-json&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="如何将上一个页面的数据传递给跳转到的下一个页面"><a href="#如何将上一个页面的数据传递给跳转到的下一个页面" class="headerlink" title="如何将上一个页面的数据传递给跳转到的下一个页面"></a>如何将上一个页面的数据传递给跳转到的下一个页面</h4><ul>
<li>通过全局对象获取</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//app.js</span><br><span class="line">App(&#123;</span><br><span class="line">  globalData: &#123;</span><br><span class="line">    userName: &apos;&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后在页面中，可以通过 getApp() 方法获取并设置app.js中的全局对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let app = getApp()</span><br><span class="line">let userName = app.globalData.userName</span><br><span class="line">app.globalData.userName = &apos;hello kitty&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过本地缓存设置和获取</li>
</ul>
<p>小程序提供了<code>wx.setStorage</code>，<code>wx.getStorage</code>, <code>wx.removeStorage</code>等本地存储的api供我们使用, 具体请查看<a href="https://developers.weixin.qq.com/miniprogram/dev/api/data.html#wxsetstorageobject" target="_blank" rel="noopener">官方文档</a>，通过这种方式一般存储的是一些不经常改变的静态变量</p>
<ul>
<li>通过url的query传值后在下一个页面的onLoad中获取</li>
</ul>
<p>可以将数据附加在url中，如<code>/book?id=100</code>, 然后在下一个页面的onLoad中获取<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onLoad (option) &#123;</span><br><span class="line">  this.setData (&#123;id: option.id&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>通过getCurrentPages()获取</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">onLoad () &#123;</span><br><span class="line">  let pages = getCurrentPages()</span><br><span class="line">  let prevPage = pages[pages.length - 2]</span><br><span class="line">  this.setData(&#123;detail: prevPage.data.detail&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>未完待续…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/22/obs-node-media-server-flv-js实现录播和直播/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/22/obs-node-media-server-flv-js实现录播和直播/" itemprop="url">obs+node-media-server+flv.js实现录播和直播</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-22T17:12:43+08:00">
                2018-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul>
<li>下载obs软件，进行视频的录制</li>
<li>通过node-media-server开启一个服务，在obs中推流到该服务器</li>
<li>通过flv.js配合html5的video标签实现node-media-server中视频源的播放</li>
</ul>
<h3 id="开始实现"><a href="#开始实现" class="headerlink" title="开始实现"></a>开始实现</h3><h4 id="obs的使用"><a href="#obs的使用" class="headerlink" title="obs的使用"></a>obs的使用</h4><p>obs的下载请移步<a href="https://obsproject.com/" target="_blank" rel="noopener">官网</a>，有windows, mac, linux 三个平台的版本可供下载<br>我这里使用的是mac版，其他版本的使用应该也差不多</p>
<ul>
<li>首先需要新建一个场景<br><img src="https://upload-images.jianshu.io/upload_images/11543643-e3898c40c5fdf380.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="新建场景.png"><br>这里有很多种场景可以使用，我用显示捕获来示范一下吧…<br><img src="https://upload-images.jianshu.io/upload_images/11543643-832208bc792de999.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="新建场景.png"><br>可以对场景进行命名，我直接使用默认的名字，点击确定<br><img src="https://upload-images.jianshu.io/upload_images/11543643-80bcfcca543f70ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="新建场景.png"></li>
</ul>
<p>再次点击确定，这个时候场景就创建成功了，拖动场景可以将场景进行缩放，缩放到遮住黑色的背景就好了<br><img src="https://upload-images.jianshu.io/upload_images/11543643-c7a8baae2b871c92.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="缩放场景.png"></p>
<ul>
<li>推流<br>视频的本质其实是一张张截下来的图片，我们需要将这一张张图片放到一个地方，然后前端就可以从这个地方读取，从而展示出来，因此在这之前我们需要开启一个服务，作为前端获取视频的源地址</li>
</ul>
<h4 id="node-media-server开启服务"><a href="#node-media-server开启服务" class="headerlink" title="node-media-server开启服务"></a>node-media-server开启服务</h4><ol>
<li><p>新建一个空白的文件夹，执行<code>npm init</code>, 根据提示输入相关信息后，下载node-media-server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-media-server --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建一个入口文件index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const NodeMediaServer = require(&apos;node-media-server&apos;);</span><br><span class="line"></span><br><span class="line">const config = &#123;</span><br><span class="line">  rtmp: &#123;</span><br><span class="line">    port: 1935,</span><br><span class="line">    chunk_size: 60000,</span><br><span class="line">    gop_cache: true,</span><br><span class="line">    ping: 60,</span><br><span class="line">    ping_timeout: 30</span><br><span class="line">  &#125;,</span><br><span class="line">  http: &#123;</span><br><span class="line">    port: 8000,</span><br><span class="line">    allow_origin: &apos;*&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var nms = new NodeMediaServer(config)</span><br><span class="line">nms.run();</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在命令行中执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果看到下面的提示，表示我们已经成功开启node-media-server服务了<br><img src="https://upload-images.jianshu.io/upload_images/11543643-9472617ff06096a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开启服务.png"></p>
<h4 id="flv-js"><a href="#flv-js" class="headerlink" title="flv.js"></a>flv.js</h4><p>flv.js是来自Bilibli的开源项目。它解析FLV文件喂给原生HTML5 Video标签播放音视频数据，使浏览器在不借助Flash的情况下播放FLV成为可能。具体的介绍请自行google哈，继续刚才的项目</p>
<ul>
<li>新建一个index.html文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;title&gt;直播&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/flv.js/1.4.0/flv.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;video id=&quot;videoElement&quot; width=&quot;100%&quot; controls&gt;&lt;/video&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        if (flvjs.isSupported()) &#123;</span><br><span class="line">            var videoElement = document.getElementById(&apos;videoElement&apos;);</span><br><span class="line">            var flvPlayer = flvjs.createPlayer(&#123;</span><br><span class="line">                type: &apos;flv&apos;,</span><br><span class="line">                url: &apos;http://localhost:8000/live/hello.flv&apos;</span><br><span class="line">            &#125;);</span><br><span class="line">            flvPlayer.attachMediaElement(videoElement);</span><br><span class="line">            flvPlayer.load();</span><br><span class="line">            flvPlayer.play();</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>这里遇到了一个坑，可能是mac的原因，默认视频是没有自动播放的，而且一开始video标签我也没有加上controls，所以网页上一直显示的是一张静态的图片，偶然才发现原来是视频处于暂停状态 =_=!!</p>
</blockquote>
<h4 id="可以进行录播啦"><a href="#可以进行录播啦" class="headerlink" title="可以进行录播啦~"></a>可以进行录播啦~</h4><ul>
<li>点击obs中的设置，进入设置页面，点击流，如果是在本地直播的话，流类型选择自定义流媒体服务器，url填写如图所示，流名称填写index.html设置的名字，本项目是<code>hello</code></li>
</ul>
<blockquote>
<p>我们也可以通过bilibili等直播平台进行播放，这里就填写你bilibili上的直播链接和名称</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/11543643-4896159d8e19ce11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>点击obs的开始推流按钮<br><img src="https://upload-images.jianshu.io/upload_images/11543643-2aa25cf702854ee5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ul>
<p>这时双击在浏览器打开index.html就可以看到直播啦，记得点击视频下方的开始按钮~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/16/css世界/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/16/css世界/" itemprop="url">css世界</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-16T16:32:21+08:00">
                2018-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>从事前端工作一年了，最近越来越觉得自己的css学得不好，虽然基本能实现项目中需要实现的效果，但是还是觉得自己了解得并不深入，最近看了张鑫旭老师写的css世界，真心觉得css真是太博大精深了，张老师讲的东西很多都是我们平时经常遇到却很少时候会知道为什么会这样的一些情况，我也通过这一篇文章来记录一下自己的学习过程，有兴趣的同学还是得买本书看看……</p>
<h3 id="css中的流"><a href="#css中的流" class="headerlink" title="css中的流"></a>css中的流</h3><ul>
<li><p>css世界中的流其实跟现实世界中的水流是类似的，例如:</p>
<ol>
<li>水流会自动铺满容器，而div也会自动铺满容器</li>
<li>在水流中放入木头，木头依次排列，而css世界中的图片文字也会依次排列，空间不足时换行</li>
</ol>
</li>
<li>流是怎样影响整个css世界的呢？<ol>
<li>让html的默认表现符合“流”</li>
<li>通过流的破坏实现特殊布局</li>
<li>通过改变流向实现不同的布局</li>
</ol>
</li>
</ul>
<h3 id="块级元素"><a href="#块级元素" class="headerlink" title="块级元素"></a>块级元素</h3><p><code>display: block; display: table; display: list-item;</code> 的元素都是块级元素，都符合块级元素的显示特征</p>
<ul>
<li><p>为什么<code>display: list-item</code>的元素会出现项目符号？</p>
<blockquote>
<p>因为生成了一个附加盒子，学名为“标记盒子”，专门用来存放圆点，数字这些项目符号，IE浏览器下伪元素不支持list-item或许是无法创建这个“标记盒子”导致的</p>
</blockquote>
</li>
<li><p><code>display: inline-block</code>是由什么盒子构成的？</p>
<blockquote>
<p>又生成了一个盒子，即每个元素都有两个盒子，外在盒子和容器盒子，外在盒子负责元素是否是一行显示，容器盒子负责宽高，内容呈现等，那么，<code>display:inline-block</code>则是由外在的inline和内在的block组成，因此可以在一行显示又可以设置宽高</p>
</blockquote>
</li>
<li><p>你真的了解width: auto吗？</p>
<p>  1.元素默认的width值为auto，这就意味着元素会充分利用可用空间，但是，当我们设置了<code>width: 100%</code>或其他固定宽度后流动性就丢失了，也失去了margin/border/padding和content内容区域自动分配水平空间的机制</p>
<ol start="2">
<li>我们经常犯的错误是设置<code>display: block</code>后又设置了<code>width: 100%</code>, 其实width: 100%是没有必要的，这会让元素丢失流动性、包裹性等特性</li>
<li>width值默认是作用在<code>content-box</code>上的，通过设置<code>box-sizing</code>可以改变<code>width</code>的作用盒子，如 <code>padding-box</code>,<code>border-box</code>，但是不存在<code>margin-box</code></li>
</ol>
</li>
<li><p>为何我们经常设置的<code>height: 100%</code>会失效？</p>
</li>
</ul>
<blockquote>
<p>规范中写道：如果包含块的高度没有显式指定，并且该元素不是绝对定位，则计算值为auto, 一句话总结：因为解释成了auto, 而 <code>auto * 100 / 100 = NaN</code></p>
</blockquote>
<ul>
<li><p>如何让height: 100%生效？</p>
<ol>
<li><p>设定显式的高度值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html, body &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用绝对定位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<p>注： 绝对定位元素的宽高百分比计算是相对于padding-box的，举个例子如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;child&quot;&gt;高度100px&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;box rel&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;child&quot;&gt;高度160px&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">  height: 160px;</span><br><span class="line">  padding: 30px;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  background-color: #beceeb;</span><br><span class="line">&#125;</span><br><span class="line">.child &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background: #cd0000;</span><br><span class="line">&#125;</span><br><span class="line">.rel &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.rel &gt; .child &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  position: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/11543643-70569847e6c288a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="绝对定位和非绝对定位百分比高度对比.png"></p>
<ul>
<li>min-width/max-width和min-height/max-height</li>
</ul>
<ol>
<li>初始值：<code>min-*</code>初始值是<code>auto</code>, <code>max-*</code> 初始值是<code>none</code></li>
<li>max-width会覆盖!important</li>
<li>min-width如果比max-width大，则min-width生效</li>
<li>通过max-height实现任意高度元素的展开收起，点击<a href="http://demo.cssworld.cn/3/3-2.php可以查看具体效果，关键代码如下：" target="_blank" rel="noopener">http://demo.cssworld.cn/3/3-2.php可以查看具体效果，关键代码如下：</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.element &#123;</span><br><span class="line">  max-height: 0;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  transition: max-height .25s;</span><br><span class="line">&#125;</span><br><span class="line">.element .active &#123;</span><br><span class="line">  max-height: 666px; #一个足够大的最大高度值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="内联元素"><a href="#内联元素" class="headerlink" title="内联元素"></a>内联元素</h3><ul>
<li>内联盒模型</li>
</ul>
<ol>
<li>内容区域：可以理解为文本选中区域</li>
<li>内联盒子：元素的外在盒子，用来决定元素是内联还是块级，可以细分为内联盒子和匿名内联盒子</li>
<li>行框盒子：每一行就是一个行框盒子，每个行框盒子又是由一个个内联盒子组成的</li>
<li>包含盒子：<p>标签就是一个包含盒子，此盒子由一行一行的行框盒子组成</p></li>
</ol>
<h3 id="盒尺寸四大家族"><a href="#盒尺寸四大家族" class="headerlink" title="盒尺寸四大家族"></a>盒尺寸四大家族</h3><ol>
<li>深入理解content<br>(1) 替换元素： 通过修改某个属性值，呈现的内容就可以被替换的元素，如<code>&lt;img&gt;</code>、<code>&lt;video&gt;</code>、<code>&lt;textarea&gt;</code><br>(2) 替换元素的尺寸计算规则<br>a. 固有尺寸： 默认尺寸<br>b. HTML尺寸：如<code>img</code>的<code>width</code>和<code>height</code>属性<br>c. css尺寸：通过css设定的尺寸<br>优先级： css尺寸 &gt; HTML尺寸 &gt; 固有尺寸<br>若上面的尺寸都没设定，则表现为<code>300px * 150px</code><br>(3) 异步加载图片的占位图片<code>&lt;img&gt;</code>通过以下设置可以提高性能<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">img &#123;visibility: hidden&#125;</span><br><span class="line">img[src] &#123;visibility: visible;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>firefox会把img当作一个普通的内联元素，css重置时建议加上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; img &#123;display: inline-block;&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/26/vue简易轮播图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="linli">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林莉的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/26/vue简易轮播图/" itemprop="url">用vue写一个轮播图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-26T16:20:01+08:00">
                2018-04-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天接到一个写轮播图的需求，话不多说，直接开写：</p>
<h4 id="html部分"><a href="#html部分" class="headerlink" title="html部分"></a>html部分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;carousel-container&quot;&gt;</span><br><span class="line">    &lt;header&gt;轮播图&lt;/header&gt;</span><br><span class="line">    &lt;section @mouseenter=&quot;_stop&quot; @mouseleave=&quot;_begin&quot;&gt;</span><br><span class="line">      &lt;ul class=&quot;carousel-text&quot; @click=&quot;changePic&quot;&gt;</span><br><span class="line">        &lt;li</span><br><span class="line">          :class=&quot;&#123;active: currentIndex === index&#125;&quot;</span><br><span class="line">          v-for=&quot;(item, index) in carouselList&quot; </span><br><span class="line">          :data-index=&quot;index&quot; </span><br><span class="line">          :key=&quot;index&quot;&gt;</span><br><span class="line">          &#123;&#123;item.text&#125;&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      &lt;transition-group tag=&quot;ul&quot; class=&apos;carousel-img-container&apos; name=&quot;fade&quot;&gt;</span><br><span class="line">        &lt;li v-for=&quot;(item, index) in carouselList&quot; </span><br><span class="line">            :key=&quot;index&quot; </span><br><span class="line">            v-show=&quot;index===currentIndex&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;item.src&quot; :alt=&quot;item.text&quot; class=&quot;carousel-img&quot;&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/transition-group&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>核心是使用<code>transition-group</code>，这是vue提供的动画切换组件，我们可以通过这个组件方便地实现轮播图图片动画的各种切换效果，当然，如果不用这个组件，也可以通过css动画来完成，代码会复杂一点，但也是可以实现的。</p>
</blockquote>
<h4 id="js部门"><a href="#js部门" class="headerlink" title="js部门"></a>js部门</h4><p>代码不多，就直接贴上来了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  name: &apos;c-carousel&apos;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      /**</span><br><span class="line">       * 图片src</span><br><span class="line">       */</span><br><span class="line">      src: require(&apos;@/assets/images/D2.1_1@2x.png&apos;),</span><br><span class="line">      /**</span><br><span class="line">       * 轮播图数据</span><br><span class="line">       */</span><br><span class="line">      carouselList: [</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;1. 第一张图片&apos;, </span><br><span class="line">          src: require(&apos;@/assets/images/D2.1_1@2x.png&apos;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;2. 第二张图片&apos;,</span><br><span class="line">          src: require(&apos;@/assets/images/D2.1_2.png&apos;),</span><br><span class="line">        &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">          text: &apos;3. 第三张图片&apos;,</span><br><span class="line">          src: require(&apos;@/assets/images/D2.1_3.png&apos;),</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      /**</span><br><span class="line">       * 当前正在显示的图片</span><br><span class="line">       */</span><br><span class="line">      currentIndex: 0,</span><br><span class="line">      /**</span><br><span class="line">       * 切换图片定时器</span><br><span class="line">       */</span><br><span class="line">      carouselTimer: null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    this._begin()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 点击切换图片</span><br><span class="line">     */</span><br><span class="line">    changePic (e) &#123;</span><br><span class="line">      this.currentIndex = parseInt(e.target.dataset.index)</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 定时切换图片</span><br><span class="line">     */</span><br><span class="line">    autoPlay () &#123;</span><br><span class="line">      this.currentIndex++</span><br><span class="line">      if (this.currentIndex &gt;= this.carouselList.length) &#123;</span><br><span class="line">        this.currentIndex = 0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 开始定时切换图片</span><br><span class="line">     */</span><br><span class="line">    _begin () &#123;</span><br><span class="line">      this.carouselTimer = setInterval (this.autoPlay, 4000)</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 停止定时切换图片</span><br><span class="line">     */</span><br><span class="line">    _stop () &#123;</span><br><span class="line">      clearInterval(this.carouselTimer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>因为使用的是<code>nuxt</code>，所以图片的引入需要用<code>require</code>,  <a href="https://nuxtjs.org/" target="_blank" rel="noopener">nuxt</a> 的好处就是有利于SEO,轮播图一般出现的场景是公司官网，对搜索引擎友好是必要条件，这是<code>spa</code>(单页web应用)无法达到的，而且<code>nuxt</code>预设了利用<code>Vue.js</code>开发服务端渲染的应用所需要的各种配置，服务端渲染能大大提高网页对加载速度</p>
</blockquote>
<h4 id="css部分核心代码"><a href="#css部分核心代码" class="headerlink" title="css部分核心代码"></a>css部分核心代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> .carousel-img-container &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    width: 100%;</span><br><span class="line">    position: relative;</span><br><span class="line">    li &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      position: absolute;</span><br><span class="line">      left: 0;</span><br><span class="line">      top: 0;</span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: center;</span><br><span class="line">      align-items: center;</span><br><span class="line">      img &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">// 动画</span><br><span class="line">.fade-enter-active, .fade-leave-active &#123;</span><br><span class="line">  transition: all 2s;</span><br><span class="line">&#125;</span><br><span class="line">.fade-enter, .fade-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transition: translateY(20px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>transition-group</code>时遇到一个问题，当添加和移除元素的时候，周围的元素会瞬间移动到他们的新布局的位置，而不是平滑的过渡，解决方案是所有图片需要相对于容器绝对定位，让每张图片叠加在一起，然后再根据判断条件显示对应的图片，关于<code>transition-group</code>的其他详细内容请查看<a href="https://cn.vuejs.org/v2/guide/transitions.html" target="_blank" rel="noopener">官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">linli</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/linliya" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linli</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
